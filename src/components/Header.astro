---
import CollapseButton from "./CollapseButton.astro";
import ExpandButton from "./ExpandButton.astro";
import SearchLink from "./SearchLink.astro";
import CollectionLink from "./CollectionLink.astro";
import {
  collectionWithGalleryMetadataMap,
  type CollectionMetadata,
} from "../consts";
import BookmarksLink from "./BookmarksLink.astro";

const collections: CollectionMetadata[] = [];
for (const collectionMetadata of collectionWithGalleryMetadataMap.values()) {
  if (collectionMetadata.isInHeader) {
    collections.push(collectionMetadata);
  }
}
---

<script>
  // Show or hide expanded state
  const header = document.querySelector("#header") as HTMLElement;
  const collectionElements = document.querySelectorAll(
    "#collection"
  ) as NodeListOf<HTMLElement>;
  const expandButton = document.querySelector("#expandButton") as HTMLElement;
  const collapseButton = document.querySelector(
    "#collapseButton"
  ) as HTMLElement;

  expandButton?.addEventListener("click", () => {
    collectionElements.forEach((el) => {
      el.style.display = "block";
    });
    expandButton.style.display = "none";
    collapseButton.style.display = "block";
    header?.setAttribute("aria-expanded", "true");
  });

  collapseButton?.addEventListener("click", () => {
    collectionElements.forEach((el) => {
      el.style.display = "none";
    });
    expandButton.style.display = "block";
    collapseButton.style.display = "none";
    header?.setAttribute("aria-expanded", "false");
  });
</script>

<nav
  id="header"
  class="flex flex-col md:sticky top-0 inset-x-0 z-0"
  aria-expanded="false"
>
  <div
    class="px-4 lg:px-12 bg-black h-24 w-full flex items-center justify-between"
  >
    <a
      class="text-white dark:text-rwb-text-dark text-3xl lg:text-4xl no-underline hover:underline"
      href="/index.html"
    >
      rwblickhan.org
    </a>
    <div class="flex flex-row items-center">
      <BookmarksLink />
      <SearchLink />
      <ExpandButton id="expandButton" />
      <CollapseButton id="collapseButton" />
    </div>
  </div>
  {
    collections.map((metadata) => (
      <CollectionLink
        id="collection"
        slug={metadata.slug}
        title={metadata.title}
      />
    ))
  }
</nav>
